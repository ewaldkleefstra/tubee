language: php
php:
- 7.2
sudo: required
addons:
  apt:
    packages:
    - imagemagick
before_install:
- echo "extension = apcu.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
- echo "extension = mongodb.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
- echo "\n" | pecl install imagick
- export version=$TRAVIS_TAG
- if [[ "${version:0:1}" == "v" ]]; then version=${version:1}; fi;
- if [ "$version" == "" ]; then version=$TRAVIS_BUILD_NUMBER; fi;
script: make VERSION=$version
notifications:
  email: false
before_deploy:
- if [[ "$version" == *"-"* ]]; then export deb_distribution=unstable; else export
  deb_distribution=stable; fi;
- if [[ "$TRAVIS_BRANCH" == "master" ]]; then export deb_distribution=nightly; fi;
- export date=$(date +%Y-%m-%d)
- cp packaging/debian/bintray.json bintray.json
- sed -i s/'{version}'/$version/g bintray.json
- sed -i s/'{date}'/$date/g bintray.json
- sed -i s/'{deb_distribution}'/$deb_distribution/g bintray.json
- cat bintray.json
deploy:
- provider: releases
  api_key:
    secure: czVE+I4h64i0LJUY4J0qLGuCjCX57VTKxlZQ+/Nb9XSE+viaCRKg2FZ3dEjXFDpEYG0S6whlyuhFPsNwyw/sbEyuCSAvsFFObw+gukfbiHHOrV6Pivc+QawZm2FqpoDqx2k5mjen+RQ3kiYwtTEjoIr+ZfObj8LDsQrSN3SX7tDS3nmEuG/PyPf/8vLK4mF6wcq9gEpnbXXTR4xqMTTy6bCK9LQ/NDlDwJ4GYOjp3+RnuPEW6u/KHR9yfG1JYQ0oqpBmVrhGHdr1+Si+Xbm2fUCgs3RVmhmKcA0Lbc94cBxqNfG9TfnEdETk3p1As0L1sX5Z3+7sbyb62+slx76D5ffkAsoqdOSHG3Lx1p3M5BlNPwZcojchwBQ7OVV1r9rddnaYaLpq1PQcwlZerPXnbFSuIMKKNLzYwdsVrKIvdI0aXaxoy6/wNGYQ6IjRA/wU3fk4M7mb7QavlbriVCS8p7R2lHFKHaVLh0qeq51WR13RKxPWmPtmXu/x3uWo0UciVxY3fIbGIrbUXi2oqSwBNANDC7vN1MZJNTN9Kf6sKPIXMzMIPGHGxh/5awgPus3rtfstkKaD/+IQhjrSviVzOU5QImHsfbUFqh8UIh3FWmVc7HTQFDXoIxOQ574fsI1b2nOKif0gE5b+T4VSUPQulVoOpt1/gPWW8g++V5cdXWI=
  file: dist/*
  skip_cleanup: true
  on:
    tags: true
- provider: bintray
  skip_cleanup: true
  file: bintray.json
  user: raffis
  on:
    tags: true
  key:
    secure: "QxetTfrGoEggP9acNOyVUPkCTzBVzR3IxGSumr4mFwyE6QWB931v0qQ1l6ig6vX4uUNdTN+H5XIrr2AE62v4bV7rLsrmx+6iL8yGxCmHMWejwqNGPO3BPWCMhOwybYRxbHks6mT240OMx/m85Hs82SMzaGXKz3FGQNr4/ChrnR1Cg7DmvFlXOVOPq0y3ETfcoHjMAmIGSQya3ZDoM1fzsDQTGMoHE6pTpgwWDiXfshfMlsD97ZoaBVikH1Ad66BI55zdWbwS1XU19LTmRFgv4q/FLeDtdovJvhGt+XiEyzTml7l0/hnrDyUARrg3lGgW+oaN7qpWF8CGhg/fQtUUMVQGVjW/+Cx2HRd9Sw9LLILNnRkHiLavaA3GXKxwc0FhV+EGRZ/NWLcEzhZdjumxj3wCz2f3aZSRN0j0vcaCurz8UzerTb7qE3yBaoNDWI1ylHybhEWuGUHszRYDjKBOM+nXDoP0fju8B2OFPVNkRgttzcvenFCEfQQDLi+KiQ3dqsBB+j0vm3QZi0EQTW9S+JKL1umkxVbYxdudJ6pjBUB1FzMeoVO3QZ+xtJ4Gd12pb105O+T7zxntjrG7fdsrD0R+Zl/QA9wce79hQtjk+P2sD8IkHzPldtx37ECM4jhFG8c4RzOVhfLWSEp1I7vRc3QgZb53RwwooR/PU3yfW6A="
after_deploy:
- ! 'if [ "$TRAVIS_TAG" != "" ]; then curl -s -X POST -H ''Content-Type: application/json''
  -H ''Accept: application/json'' -H ''Travis-API-Version: 3'' -H "Authorization:
  token $TRAVIS_API_TOKEN" -d ''{"request":{"message":"trigger build", "branch":"master",
  "config":{"env":{"REPOSITORY": "''"$deb_distribution"''", "VERSION":"''"$version"''"}}}}''
  "https://api.travis-ci.org/repo/gyselroth%2Ftubee-docker/requests"; fi'
